# 画布编辑功能说明

## 功能概述

为每个画布添加了编辑和下载功能，支持在右侧弹出的侧边栏中进行结构化编辑。

## 功能特性

### 1. 悬浮按钮
- 鼠标悬浮在画布上时，右上角显示两个按钮：
  - ✏️ **编辑按钮**：打开侧边栏编辑器
  - ⬇️ **下载按钮**：直接下载当前画布为 PNG

### 2. 侧边栏编辑器
弹出的编辑器支持以下操作：

#### 基本编辑
- **区域名称**：编辑画布标题（region）
- **Section 标题**：编辑每个段落的标题
- **Section 内容**：编辑多行文本内容

#### 奖励管理
- **编辑奖励**：修改奖励名称、描述
- **替换图片**：点击"更换图片"按钮上传新图片
- **添加奖励**：点击"+ 添加奖励"按钮新增奖励项
- **删除奖励**：点击"删除"按钮移除奖励项

#### 结构管理
- **添加文案段落**：在每个 block 底部可以添加新的 section
- **保存更改**：点击底部"保存"按钮应用更改到画布

### 3. 单个画布下载
- 点击画布右上角的下载按钮，直接下载当前画布
- 文件名使用画布的 region 名称（如 "A.png"、"B.png"）

## 技术实现

### 新增文件
- `web/src/components/EditSidebar.tsx`：侧边栏编辑器组件

### 修改文件
- `web/src/pages/preview.tsx`：
  - 修改 `CanvasCell` 组件，添加悬浮按钮和交互
  - 添加编辑状态管理（`isEditSidebarOpen`、`editingPageIndex`、`editingPage`）
  - 实现 `onEditPage`：打开编辑器
  - 实现 `onSavePage`：保存编辑并更新 allSheets
  - 实现 `onDownloadPage`：下载单个画布

- `web/src/renderer/canvas/index.tsx`：
  - 修改 `exportPagesToPng`，使用 `page.region` 作为文件名

## 使用方法

1. **编辑画布**：
   - 鼠标悬浮在画布上
   - 点击右上角的编辑按钮（✏️）
   - 在侧边栏中编辑内容
   - 点击"保存"按钮应用更改

2. **下载单个画布**：
   - 鼠标悬浮在画布上
   - 点击右上角的下载按钮（⬇️）
   - 自动下载为 PNG 文件

3. **添加奖励**：
   - 在编辑器中找到对应的 section
   - 点击"+ 添加奖励"按钮
   - 填写奖励名称和描述
   - 点击"更换图片"上传图片

4. **添加文案**：
   - 在编辑器的 block 底部
   - 点击"+ 添加文案段落"按钮
   - 填写标题和内容

## 注意事项

1. **图片上传**：当前上传的图片以 data URL 格式存储，刷新页面后会保留在编辑状态中
2. **数据持久化**：编辑后的数据保存在浏览器内存中，刷新页面后会重置为原始数据
3. **文件名规范**：下载的文件名会自动清理非法字符（`<>:"/\|?*`）

## 后续优化建议

1. 支持图片上传到后端 blob store（需要后端 API 支持）
2. 支持导出编辑后的数据为 JSON 文件
3. 添加撤销/重做功能
4. 支持批量编辑多个画布
5. 添加数据验证和错误提示

